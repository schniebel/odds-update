apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kube-prometheus-stack
  namespace: kube-prometheus-stack
spec:
  chart:
    spec:
      chart: ./kube-prometheus-stack
      version: 73.2.0
      sourceRef:
        kind: GitRepository
        name: helm-charts
        namespace: flux-system
  interval: 1m
  values:
    alertmanager:
      enabled: true
    prometheus:
      prometheusSpec:
        externalLabels:
          cluster: builder
        additionalAlertManagerConfigsSecret: null
        additionalAlertManagerConfigs:
          - scheme: https
            static_configs:
              - targets:
                  - <alertmanager endpoint url here>
    grafana:
      enabled: true
      <additional grafana settings here>
    coreDns:
      enabled: false
    defaultRules:
      rules:
        kubeControllerManager: false
        kubeProxy: false
        kubeSchedulerAlerting: false
